{% extends 'backend/baseBack.html.twig' %}

{% block content %}
<link rel="stylesheet" href="{{ asset('css/User/backUser.css') }}">
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">List of Users</h6>
    </div>
    <div style="display: flex; align-self:center; gap: 20px;">
        <button class="refresh"><a href="{{ path('user_list') }}"><svg width="12" height="12" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path d="M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z"/>
        </svg></a></button>
        <div class="dropdown">
            <button class="dropdown-button" onclick="toggleDropdownSort()">Sort by</button>
            <div class="dropdown-content" id="dropdownSortMenu">
                <a href="{{ path('user_list', {'sort': 'firstNameUser', 'direction': 'ASC'}) }}">First Name <svg xmlns="http://www.w3.org/2000/svg" width=12 height=12 viewBox="0 0 320 512"><path fill="#ddd" d="M318 177.5c3.8-8.8 2-19-4.6-26l-136-144C172.9 2.7 166.6 0 160 0s-12.9 2.7-17.4 7.5l-136 144c-6.6 7-8.4 17.2-4.6 26S14.4 192 24 192l72 0 0 288c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-288 72 0c9.6 0 18.2-5.7 22-14.5z"/></svg></a>
                <a href="{{ path('user_list', {'sort': 'firstNameUser', 'direction': 'DESC'}) }}">First Name <svg xmlns="http://www.w3.org/2000/svg" width=12 height=12 viewBox="0 0 320 512"><path fill="#ddd" d="M2 334.5c-3.8 8.8-2 19 4.6 26l136 144c4.5 4.8 10.8 7.5 17.4 7.5s12.9-2.7 17.4-7.5l136-144c6.6-7 8.4-17.2 4.6-26s-12.5-14.5-22-14.5l-72 0 0-288c0-17.7-14.3-32-32-32L128 0C110.3 0 96 14.3 96 32l0 288-72 0c-9.6 0-18.2 5.7-22 14.5z"/></svg></a>
                <a href="{{ path('user_list', {'sort': 'lastNameUser', 'direction': 'ASC'}) }}">Last Name <svg xmlns="http://www.w3.org/2000/svg" width=12 height=12 viewBox="0 0 320 512"><path fill="#ddd" d="M318 177.5c3.8-8.8 2-19-4.6-26l-136-144C172.9 2.7 166.6 0 160 0s-12.9 2.7-17.4 7.5l-136 144c-6.6 7-8.4 17.2-4.6 26S14.4 192 24 192l72 0 0 288c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-288 72 0c9.6 0 18.2-5.7 22-14.5z"/></svg></a>
                <a href="{{ path('user_list', {'sort': 'lastNameUser', 'direction': 'DESC'}) }}">Last Name <svg xmlns="http://www.w3.org/2000/svg" width=12 height=12 viewBox="0 0 320 512"><path fill="#ddd" d="M2 334.5c-3.8 8.8-2 19 4.6 26l136 144c4.5 4.8 10.8 7.5 17.4 7.5s12.9-2.7 17.4-7.5l136-144c6.6-7 8.4-17.2 4.6-26s-12.5-14.5-22-14.5l-72 0 0-288c0-17.7-14.3-32-32-32L128 0C110.3 0 96 14.3 96 32l0 288-72 0c-9.6 0-18.2 5.7-22 14.5z"/></svg></a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropdown-button" onclick="toggleDropdownFilter()">Filter by</button>
            <div class="dropdown-content" id="dropdownFilterMenu">
                <a href="{{ path('user_list', {'filter': 'paymentDetails', 'value': 'PAYPAL'}) }}">PayPal</a>
                <a href="{{ path('user_list', {'filter': 'paymentDetails', 'value': 'CREDIT_CARD'}) }}">Credit Card</a>
                <a href="{{ path('user_list', {'filter': 'paymentDetails', 'value': 'BANK_TRANSFER'}) }}">Bank Transfer</a>
            </div>
        </div>
        <div class="alignSearchSVG">
            <input type="text" id="searchInput" placeholder="Search..." />
            <svg id="searchIconButton" xmlns="http://www.w3.org/2000/svg" style="margin-left:5px;" height="12" width="12" viewBox="0 0 512 512">
                <path fill="#ddd" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/>
            </svg>
        </div>
    </div>

     <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover table-striped shadow" id="dataTable">
                <thead class="thead">
                    <tr>
                        <th>Email</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Phone</th>
                        <th>Payment</th>
                        <th>Address</th>
                        <th class="action-column">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in pagination %}
                        <tr>
                            <td>{{ user.emailUser }}</td>
                            <td>{{ user.firstNameUser }}</td>
                            <td>{{ user.lastNameUser }}</td>
                            <td>{{ user.phoneNumber }}</td>
                            <td>{{ user.paymentDetails }}</td>
                            <td>{{ user.address }}</td>
                            <td class="action-column">
 
    <div class="btn-group btn-group-sm">
        {% if user.isBanned %}
            <form action="{{ path('user_unban', {'idUser': user.idUser}) }}" method="post" class="d-inline">
                <input type="hidden" name="_token" value="{{ csrf_token('unban' ~ user.idUser) }}">
                <button type="submit" class="btn btn-success btn-sm" title="Unban"
                        onclick="return confirm('Are you sure you want to unban this user?')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14" fill="currentColor">
                        <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>
                    </svg>
                </button>
            </form>
        {% else %}
            <a href="{{ path('user_ban', {'idUser': user.idUser}) }}" 
               class="btn btn-warning btn-sm" 
               title="Ban">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14" fill="currentColor">
                    <path d="M367.2 412.5L99.5 144.8C77.1 176.1 64 214.5 64 256c0 106 86 192 192 192c41.5 0 79.9-13.1 111.2-35.5zm45.3-45.3C434.9 335.9 448 297.5 448 256c0-106-86-192-192-192c-41.5 0-79.9 13.1-111.2 35.5L412.5 367.2zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/>
                </svg>
            </a>
        {% endif %}
        
        <a href="{{ path('user_delete', {'idUser': user.idUser}) }}" 
           class="btn btn-danger btn-sm" 
           title="Delete"
           onclick="return confirm('Are you sure you want to delete this user?')">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="14" height="14" fill="currentColor">
                <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/>
            </svg>
        </a>
    </div>
</td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="7" class="text-center text-muted py-3">
                                No users found
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div class="navigation">
                {{ knp_pagination_render(pagination) }}
            </div>
        </div>
    </div>
</div>

<style>
    .navigation {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }
    .pagination .page-item.active .page-link {
        background-color: #4e73df;
        border-color: #4e73df;
    }
</style>


<script>
   // Dropdown toggle
    function toggleDropdownFilter() {
        const dropdown = document.getElementById("dropdownFilterMenu");
        dropdown.classList.toggle("show");
    }
    
    function toggleDropdownSort() {
        const dropdown = document.getElementById("dropdownSortMenu");
        dropdown.classList.toggle("show");
    }

    window.onclick = function(event) {
        if (!event.target.matches('.dropdown-button')) {
            const dropdownFilter = document.getElementById("dropdownFilterMenu");
            if (dropdownFilter && dropdownFilter.classList.contains("show")) {
                dropdownFilter.classList.remove("show");
            }
            const dropdownSort = document.getElementById("dropdownSortMenu");
            if (dropdownSort && dropdownSort.classList.contains("show")) {
                dropdownSort.classList.remove("show");
            }
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("searchInput");
        const searchButton = document.getElementById("searchIconButton");
        
        // Handle Enter key in search input
        input.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
                e.preventDefault();
                performSearch();
            }
        });
        
        // Handle click on search button
        searchButton.addEventListener("click", function() {
            performSearch();
        });
        
        function performSearch() {
            const query = input.value.trim();
            if (query) {
                window.location.href = "{{ path('user_list') }}?search=" + encodeURIComponent(query);
            } else {
                window.location.href = "{{ path('user_list') }}";
            }
        }
    });
  
</script>

{% endblock %}


